import{_ as l}from"./plugin-vue_export-helper-c27b6911.js";import{r as i,o as u,c as r,a as n,b as s,d as o,w as a,f as k}from"./app-3f278ba4.js";const d={},m=n("div",{class:"hint-container note"},[n("p",{class:"hint-container-title"},"æ³¨"),n("p",null,"Extensions only work in Chrome / Chromium launched with a persistent context.")],-1),v={href:"https://developer.chrome.com/extensions/background_pages",target:"_blank",rel:"noopener noreferrer"},b={href:"https://developer.chrome.com/docs/extensions/mv2/",target:"_blank",rel:"noopener noreferrer"},g=n("code",null,"./my-extension",-1),h=n("br",null,null,-1),y=n("br",null,null,-1),x=k(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> chromium <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;playwright&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> pathToExtension <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;my-extension&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> userDataDir <span class="token operator">=</span> <span class="token string">&#39;/tmp/test-user-data-dir&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> browserContext <span class="token operator">=</span> <span class="token keyword">await</span> chromium<span class="token punctuation">.</span><span class="token function">launchPersistentContext</span><span class="token punctuation">(</span>userDataDir<span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">--disable-extensions-except=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>pathToExtension<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">--load-extension=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>pathToExtension<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>backgroundPage<span class="token punctuation">]</span> <span class="token operator">=</span> browserContext<span class="token punctuation">.</span><span class="token function">backgroundPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>backgroundPage<span class="token punctuation">)</span>
    backgroundPage <span class="token operator">=</span> <span class="token keyword">await</span> browserContext<span class="token punctuation">.</span><span class="token function">waitForEvent</span><span class="token punctuation">(</span><span class="token string">&#39;backgroundpage&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Test the background page as you would any other page.</span>
  <span class="token keyword">await</span> browserContext<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>@tab python async</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> asyncio
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>async_api <span class="token keyword">import</span> async_playwright

path_to_extension <span class="token operator">=</span> <span class="token string">&quot;./my-extension&quot;</span>
user_data_dir <span class="token operator">=</span> <span class="token string">&quot;/tmp/test-user-data-dir&quot;</span>


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>playwright<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context <span class="token operator">=</span> <span class="token keyword">await</span> playwright<span class="token punctuation">.</span>chromium<span class="token punctuation">.</span>launch_persistent_context<span class="token punctuation">(</span>
        user_data_dir<span class="token punctuation">,</span>
        headless<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
        args<span class="token operator">=</span><span class="token punctuation">[</span>
            <span class="token string-interpolation"><span class="token string">f&quot;--disable-extensions-except=</span><span class="token interpolation"><span class="token punctuation">{</span>path_to_extension<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span>
            <span class="token string-interpolation"><span class="token string">f&quot;--load-extension=</span><span class="token interpolation"><span class="token punctuation">{</span>path_to_extension<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>background_pages<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        background_page <span class="token operator">=</span> <span class="token keyword">await</span> context<span class="token punctuation">.</span>wait_for_event<span class="token punctuation">(</span><span class="token string">&#39;backgroundpage&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        background_page <span class="token operator">=</span> context<span class="token punctuation">.</span>background_pages<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token comment"># Test the background page as you would any other page.</span>
    <span class="token keyword">await</span> context<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> async_playwright<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> playwright<span class="token punctuation">:</span>
        <span class="token keyword">await</span> run<span class="token punctuation">(</span>playwright<span class="token punctuation">)</span>


asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>@tab python sync</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> sync_playwright

path_to_extension <span class="token operator">=</span> <span class="token string">&quot;./my-extension&quot;</span>
user_data_dir <span class="token operator">=</span> <span class="token string">&quot;/tmp/test-user-data-dir&quot;</span>


<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>playwright<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context <span class="token operator">=</span> playwright<span class="token punctuation">.</span>chromium<span class="token punctuation">.</span>launch_persistent_context<span class="token punctuation">(</span>
        user_data_dir<span class="token punctuation">,</span>
        headless<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
        args<span class="token operator">=</span><span class="token punctuation">[</span>
            <span class="token string-interpolation"><span class="token string">f&quot;--disable-extensions-except=</span><span class="token interpolation"><span class="token punctuation">{</span>path_to_extension<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span>
            <span class="token string-interpolation"><span class="token string">f&quot;--load-extension=</span><span class="token interpolation"><span class="token punctuation">{</span>path_to_extension<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>background_pages<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        background_page <span class="token operator">=</span> context<span class="token punctuation">.</span>wait_for_event<span class="token punctuation">(</span><span class="token string">&#39;backgroundpage&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        background_page <span class="token operator">=</span> context<span class="token punctuation">.</span>background_pages<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token comment"># Test the background page as you would any other page.</span>
    context<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">with</span> sync_playwright<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> playwright<span class="token punctuation">:</span>
    run<span class="token punctuation">(</span>playwright<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>:::</p><h2 id="testing" tabindex="-1"><a class="header-anchor" href="#testing" aria-hidden="true">#</a> Testing</h2><p>To have the extension loaded when running tests you can use a test fixture to set the context. You can also dynamically retrieve the extension id and use it to load and test the popup page for example.</p><p>First, add fixtures that will load the extension:</p>`,9),w=n("div",{class:"language-typescript line-numbers-mode","data-ext":"ts"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// fixtures.ts"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" test "),n("span",{class:"token keyword"},"as"),s(" base"),n("span",{class:"token punctuation"},","),s(" expect"),n("span",{class:"token punctuation"},","),s(" chromium"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"type"),s(),n("span",{class:"token class-name"},"BrowserContext"),s(),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@playwright/test'"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(" path "),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'path'"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(" test "),n("span",{class:"token operator"},"="),s(" base"),n("span",{class:"token punctuation"},"."),n("span",{class:"token generic-function"},[n("span",{class:"token function"},"extend"),n("span",{class:"token generic class-name"},[n("span",{class:"token operator"},"<"),n("span",{class:"token punctuation"},"{"),s(`
  context`),n("span",{class:"token operator"},":"),s(" BrowserContext"),n("span",{class:"token punctuation"},";"),s(`
  extensionId`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"string"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token operator"},">")])]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token function-variable function"},"context"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(" use"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" pathToExtension "),n("span",{class:"token operator"},"="),s(" path"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"join"),n("span",{class:"token punctuation"},"("),s("__dirname"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'my-extension'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" context "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" chromium"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"launchPersistentContext"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"''"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
      headless`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
      args`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"["),s(`
        `),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"--disable-extensions-except="),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("pathToExtension"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"--load-extension="),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("pathToExtension"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token function"},"use"),n("span",{class:"token punctuation"},"("),s("context"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"await"),s(" context"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token function-variable function"},"extensionId"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" context "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(" use"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},`/*
    // for manifest v2:
    let [background] = context.backgroundPages()
    if (!background)
      background = await context.waitForEvent('backgroundpage')
    */`),s(`

    `),n("span",{class:"token comment"},"// for manifest v3:"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token punctuation"},"["),s("background"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(" context"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"serviceWorkers"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("background"),n("span",{class:"token punctuation"},")"),s(`
      background `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" context"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"waitForEvent"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'serviceworker'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token keyword"},"const"),s(" extensionId "),n("span",{class:"token operator"},"="),s(" background"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"url"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"split"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'/'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token function"},"use"),n("span",{class:"token punctuation"},"("),s("extensionId"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(" expect "),n("span",{class:"token operator"},"="),s(" test"),n("span",{class:"token punctuation"},"."),s("expect"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),_=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token comment"},"# conftest.py"),s(`
`),n("span",{class:"token keyword"},"from"),s(" typing "),n("span",{class:"token keyword"},"import"),s(` Generator
`),n("span",{class:"token keyword"},"from"),s(" pathlib "),n("span",{class:"token keyword"},"import"),s(` Path
`),n("span",{class:"token keyword"},"from"),s(" playwright"),n("span",{class:"token punctuation"},"."),s("sync_api "),n("span",{class:"token keyword"},"import"),s(" Playwright"),n("span",{class:"token punctuation"},","),s(` BrowserContext
`),n("span",{class:"token keyword"},"import"),s(` pytest


`),n("span",{class:"token decorator annotation punctuation"},[s("@pytest"),n("span",{class:"token punctuation"},"."),s("fixture")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"context"),n("span",{class:"token punctuation"},"("),s("playwright"),n("span",{class:"token punctuation"},":"),s(" Playwright"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(" Generator"),n("span",{class:"token punctuation"},"["),s("BrowserContext"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},":"),s(`
    path_to_extension `),n("span",{class:"token operator"},"="),s(" Path"),n("span",{class:"token punctuation"},"("),s("__file__"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("parent"),n("span",{class:"token punctuation"},"."),s("joinpath"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"my-extension"'),n("span",{class:"token punctuation"},")"),s(`
    context `),n("span",{class:"token operator"},"="),s(" playwright"),n("span",{class:"token punctuation"},"."),s("chromium"),n("span",{class:"token punctuation"},"."),s("launch_persistent_context"),n("span",{class:"token punctuation"},"("),s(`
        `),n("span",{class:"token string"},'""'),n("span",{class:"token punctuation"},","),s(`
        headless`),n("span",{class:"token operator"},"="),n("span",{class:"token boolean"},"False"),n("span",{class:"token punctuation"},","),s(`
        args`),n("span",{class:"token operator"},"="),n("span",{class:"token punctuation"},"["),s(`
            `),n("span",{class:"token string-interpolation"},[n("span",{class:"token string"},'f"--disable-extensions-except='),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),s("path_to_extension"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'"')]),n("span",{class:"token punctuation"},","),s(`
            `),n("span",{class:"token string-interpolation"},[n("span",{class:"token string"},'f"--load-extension='),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),s("path_to_extension"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'"')]),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"yield"),s(` context
    context`),n("span",{class:"token punctuation"},"."),s("close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token decorator annotation punctuation"},[s("@pytest"),n("span",{class:"token punctuation"},"."),s("fixture")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"extension_id"),n("span",{class:"token punctuation"},"("),s("context"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(" Generator"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# for manifest v2:"),s(`
    `),n("span",{class:"token comment"},"# background = context.background_pages[0]"),s(`
    `),n("span",{class:"token comment"},"# if not background:"),s(`
    `),n("span",{class:"token comment"},'#     background = context.wait_for_event("backgroundpage")'),s(`

    `),n("span",{class:"token comment"},"# for manifest v3:"),s(`
    background `),n("span",{class:"token operator"},"="),s(" context"),n("span",{class:"token punctuation"},"."),s("service_workers"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token keyword"},"not"),s(" background"),n("span",{class:"token punctuation"},":"),s(`
        background `),n("span",{class:"token operator"},"="),s(" context"),n("span",{class:"token punctuation"},"."),s("wait_for_event"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"serviceworker"'),n("span",{class:"token punctuation"},")"),s(`

    extension_id `),n("span",{class:"token operator"},"="),s(" background"),n("span",{class:"token punctuation"},"."),s("url"),n("span",{class:"token punctuation"},"."),s("split"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"/"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},"]"),s(`
    `),n("span",{class:"token keyword"},"yield"),s(` extension_id

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),f=n("p",null,"Then use these fixtures in a test:",-1),C=n("div",{class:"language-typescript line-numbers-mode","data-ext":"ts"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" test"),n("span",{class:"token punctuation"},","),s(" expect "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'./fixtures'"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token function"},"test"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'example test'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" page "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" page"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"goto"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'https://example.com'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("page"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"locator"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'body'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toHaveText"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'Changed by my-extension'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token function"},"test"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'popup page'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" page"),n("span",{class:"token punctuation"},","),s(" extensionId "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" page"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"goto"),n("span",{class:"token punctuation"},"("),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"chrome-extension://"),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("extensionId"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"},"/popup.html"),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("page"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"locator"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'body'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toHaveText"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'my-extension popup'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),T=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token comment"},"# test_foo.py"),s(`
`),n("span",{class:"token keyword"},"from"),s(" playwright"),n("span",{class:"token punctuation"},"."),s("sync_api "),n("span",{class:"token keyword"},"import"),s(" expect"),n("span",{class:"token punctuation"},","),s(` Page


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"test_example_test"),n("span",{class:"token punctuation"},"("),s("page"),n("span",{class:"token punctuation"},":"),s(" Page"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    page`),n("span",{class:"token punctuation"},"."),s("goto"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"https://example.com"'),n("span",{class:"token punctuation"},")"),s(`
    expect`),n("span",{class:"token punctuation"},"("),s("page"),n("span",{class:"token punctuation"},"."),s("locator"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"body"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("to_contain_text"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Changed by my-extension"'),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"test_popup_page"),n("span",{class:"token punctuation"},"("),s("page"),n("span",{class:"token punctuation"},":"),s(" Page"),n("span",{class:"token punctuation"},","),s(" extension_id"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token builtin"},"str"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token boolean"},"None"),n("span",{class:"token punctuation"},":"),s(`
    page`),n("span",{class:"token punctuation"},"."),s("goto"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string-interpolation"},[n("span",{class:"token string"},'f"chrome-extension://'),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),s("extension_id"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'/popup.html"')]),n("span",{class:"token punctuation"},")"),s(`
    expect`),n("span",{class:"token punctuation"},"("),s("page"),n("span",{class:"token punctuation"},"."),s("locator"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"body"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("to_have_text"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"my-extension popup"'),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),q=n("h2",{id:"headless-mode",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#headless-mode","aria-hidden":"true"},"#"),s(" Headless mode")],-1),E=n("p",null,"By default, Chrome's headless mode in Playwright does not support Chrome extensions. To overcome this limitation, you can run Chrome's persistent context with a new headless mode by using the following code:",-1),P=n("div",{class:"language-typescript line-numbers-mode","data-ext":"ts"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// fixtures.ts"),s(`
`),n("span",{class:"token comment"},"// ..."),s(`

`),n("span",{class:"token keyword"},"const"),s(" pathToExtension "),n("span",{class:"token operator"},"="),s(" path"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"join"),n("span",{class:"token punctuation"},"("),s("__dirname"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'my-extension'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"const"),s(" context "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" chromium"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"launchPersistentContext"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"''"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
  headless`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
  args`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"["),s(`
    `),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"--headless=new"),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"// the new headless arg for chrome v109+. Use '--headless=chrome' as arg for browsers v94-108."),s(`
    `),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"--disable-extensions-except="),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("pathToExtension"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"--load-extension="),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("pathToExtension"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"// ..."),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),A=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token comment"},"# conftest.py"),s(`
path_to_extension `),n("span",{class:"token operator"},"="),s(" Path"),n("span",{class:"token punctuation"},"("),s("__file__"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("parent"),n("span",{class:"token punctuation"},"."),s("joinpath"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"my-extension"'),n("span",{class:"token punctuation"},")"),s(`
context `),n("span",{class:"token operator"},"="),s(" playwright"),n("span",{class:"token punctuation"},"."),s("chromium"),n("span",{class:"token punctuation"},"."),s("launch_persistent_context"),n("span",{class:"token punctuation"},"("),s(`
    `),n("span",{class:"token string"},'""'),n("span",{class:"token punctuation"},","),s(`
    headless`),n("span",{class:"token operator"},"="),n("span",{class:"token boolean"},"False"),n("span",{class:"token punctuation"},","),s(`
    args`),n("span",{class:"token operator"},"="),n("span",{class:"token punctuation"},"["),s(`
        `),n("span",{class:"token string"},'"--headless=new"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"# the new headless arg for chrome v109+. Use '--headless=chrome' as arg for browsers v94-108."),s(`
        `),n("span",{class:"token string-interpolation"},[n("span",{class:"token string"},'f"--disable-extensions-except='),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),s("path_to_extension"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'"')]),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token string-interpolation"},[n("span",{class:"token string"},'f"--load-extension='),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),s("path_to_extension"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'"')]),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1);function N(j,B){const c=i("ExternalLinkIcon"),p=i("CodeTabs");return u(),r("div",null,[m,n("p",null,[s("The following is code for getting a handle to the "),n("a",v,[s("background page"),o(c)]),s(" of a "),n("a",b,[s("Manifest v2"),o(c)]),s(" extension whose source is located in "),g,s(":"),h,s(" ::: code-tabs:lang"),y,s(" @tab js")]),x,o(p,{id:"29",data:[{id:"ts"},{id:"python"}],"tab-id":"lang"},{title0:a(({value:t,isActive:e})=>[s("ts")]),title1:a(({value:t,isActive:e})=>[s("python")]),tab0:a(({value:t,isActive:e})=>[w]),tab1:a(({value:t,isActive:e})=>[_]),_:1}),f,o(p,{id:"40",data:[{id:"ts"},{id:"python"}],"tab-id":"lang"},{title0:a(({value:t,isActive:e})=>[s("ts")]),title1:a(({value:t,isActive:e})=>[s("python")]),tab0:a(({value:t,isActive:e})=>[C]),tab1:a(({value:t,isActive:e})=>[T]),_:1}),q,E,o(p,{id:"54",data:[{id:"ts"},{id:"python"}],"tab-id":"lang"},{title0:a(({value:t,isActive:e})=>[s("ts")]),title1:a(({value:t,isActive:e})=>[s("python")]),tab0:a(({value:t,isActive:e})=>[P]),tab1:a(({value:t,isActive:e})=>[A]),_:1})])}const $=l(d,[["render",N],["__file","chrome-extensions.html.vue"]]);export{$ as default};
