import{_ as o}from"./plugin-vue_export-helper-c27b6911.js";import{r as i,o as c,c as u,e as r,a as s,b as n,d as a,w as p,f as t}from"./app-207e7d61.js";const d={},k=s("p",null,[n("Playwright tests can be executed in CI environments. We have created sample"),s("br"),n(" configurations for common CI providers.")],-1),v=s("h2",{id:"introduction",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#introduction","aria-hidden":"true"},"#"),n(" Introduction")],-1),m=s("p",null,"3 steps to get your tests running on CI:",-1),h=s("strong",null,"Ensure CI agent can run browsers",-1),b=s("br",null,null,-1),y=t(`<li><p><strong>Install Playwright</strong>:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># Install NPM packages</span>
<span class="token function">npm</span> ci
<span class="token comment"># or</span>
<span class="token function">npm</span> <span class="token function">install</span>

<span class="token comment"># Install Playwright browsers and dependencies</span>
npx playwright <span class="token function">install</span> --with-deps
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pip <span class="token function">install</span> playwright
playwright <span class="token function">install</span> --with-deps
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mvn exec:java <span class="token parameter variable">-e</span> <span class="token parameter variable">-D</span> <span class="token assign-left variable">exec.mainClass</span><span class="token operator">=</span>com.microsoft.playwright.CLI <span class="token parameter variable">-D</span> <span class="token assign-left variable">exec.args</span><span class="token operator">=</span><span class="token string">&quot;install --with-deps&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pwsh bin/Debug/netX/playwright.ps1 <span class="token function">install</span> --with-deps
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p><strong>Run your tests</strong>:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>npx playwright <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pytest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mvn <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>dotnet <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li>`,2),g=s("h2",{id:"ci-configurations",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#ci-configurations","aria-hidden":"true"},"#"),n(" CI configurations")],-1),w=t(`<h3 id="github-actions" tabindex="-1"><a class="header-anchor" href="#github-actions" aria-hidden="true">#</a> GitHub Actions</h3><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">steps</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
  <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v3
    <span class="token key atrule">with</span><span class="token punctuation">:</span>
      <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">&#39;18&#39;</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies
    <span class="token key atrule">run</span><span class="token punctuation">:</span> npm ci
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Playwright
    <span class="token key atrule">run</span><span class="token punctuation">:</span> npx playwright install <span class="token punctuation">-</span><span class="token punctuation">-</span>with<span class="token punctuation">-</span>deps
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run your tests
    <span class="token key atrule">run</span><span class="token punctuation">:</span> npx playwright test
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Upload test results
    <span class="token key atrule">if</span><span class="token punctuation">:</span> always()
    <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/upload<span class="token punctuation">-</span>artifact@v3
    <span class="token key atrule">with</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> playwright<span class="token punctuation">-</span>report
      <span class="token key atrule">path</span><span class="token punctuation">:</span> playwright<span class="token punctuation">-</span>report
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">steps</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Set up Python
    <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>python@v4
    <span class="token key atrule">with</span><span class="token punctuation">:</span>
      <span class="token key atrule">python-version</span><span class="token punctuation">:</span> <span class="token string">&#39;3.11&#39;</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies
    <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      python -m pip install --upgrade pip
      pip install -r local-requirements.txt
      pip install -e .</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Ensure browsers are installed
    <span class="token key atrule">run</span><span class="token punctuation">:</span> python <span class="token punctuation">-</span>m playwright install <span class="token punctuation">-</span><span class="token punctuation">-</span>with<span class="token punctuation">-</span>deps
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run your tests
    <span class="token key atrule">run</span><span class="token punctuation">:</span> pytest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">steps</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
  <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>java@v3
    <span class="token key atrule">with</span><span class="token punctuation">:</span>
      <span class="token key atrule">distribution</span><span class="token punctuation">:</span> <span class="token string">&#39;temurin&#39;</span>
      <span class="token key atrule">java-version</span><span class="token punctuation">:</span> <span class="token string">&#39;17&#39;</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build &amp; Install
    <span class="token key atrule">run</span><span class="token punctuation">:</span> mvn <span class="token punctuation">-</span>B install <span class="token punctuation">-</span>D skipTests <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>transfer<span class="token punctuation">-</span>progress
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Playwright
    <span class="token key atrule">run</span><span class="token punctuation">:</span> mvn exec<span class="token punctuation">:</span>java <span class="token punctuation">-</span>e <span class="token punctuation">-</span>D exec.mainClass=com.microsoft.playwright.CLI <span class="token punctuation">-</span>D exec.args=&quot;install <span class="token punctuation">-</span><span class="token punctuation">-</span>with<span class="token punctuation">-</span>deps&quot;
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run tests
    <span class="token key atrule">run</span><span class="token punctuation">:</span> mvn test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">steps</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Setup dotnet
    <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>dotnet@v3
    <span class="token key atrule">with</span><span class="token punctuation">:</span>
      <span class="token key atrule">dotnet-version</span><span class="token punctuation">:</span> 6.0.x
  <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> dotnet build
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Ensure browsers are installed
    <span class="token key atrule">run</span><span class="token punctuation">:</span> pwsh bin\\Debug\\net6.0\\playwright.ps1 install <span class="token punctuation">-</span><span class="token punctuation">-</span>with<span class="token punctuation">-</span>deps
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run your tests
    <span class="token key atrule">run</span><span class="token punctuation">:</span> dotnet test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),_={href:"https://github.com/microsoft/playwright/blob/main/.github/workflows/tests_secondary.yml",target:"_blank",rel:"noopener noreferrer"},f=s("h3",{id:"github-actions-on-deployment",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#github-actions-on-deployment","aria-hidden":"true"},"#"),n(" GitHub Actions on deployment")],-1),x={href:"https://developer.github.com/v3/repos/deployments/",target:"_blank",rel:"noopener noreferrer"},j=s("code",null,"success",-1),T=s("br",null,null,-1),I=t(`<div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> Playwright Tests
<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">deployment_status</span><span class="token punctuation">:</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">test</span><span class="token punctuation">:</span>
    <span class="token key atrule">timeout-minutes</span><span class="token punctuation">:</span> <span class="token number">60</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">if</span><span class="token punctuation">:</span> github.event.deployment_status.state == &#39;success&#39;
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
    <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v3
      <span class="token key atrule">with</span><span class="token punctuation">:</span>
        <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">&#39;18.x&#39;</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies
      <span class="token key atrule">run</span><span class="token punctuation">:</span> npm ci
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Playwright
      <span class="token key atrule">run</span><span class="token punctuation">:</span> npx playwright install <span class="token punctuation">-</span><span class="token punctuation">-</span>with<span class="token punctuation">-</span>deps
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run Playwright tests
      <span class="token key atrule">run</span><span class="token punctuation">:</span> npx playwright test
      <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token comment"># This might depend on your test-runner/language binding</span>
        <span class="token key atrule">PLAYWRIGHT_TEST_BASE_URL</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> github.event.deployment_status.target_url <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="docker" tabindex="-1"><a class="header-anchor" href="#docker" aria-hidden="true">#</a> Docker</h3>`,2),C=s("p",null,"Suggested configuration",-1),P=s("code",null,"--ipc=host",-1),D=s("br",null,null,-1),E={href:"https://docs.docker.com/engine/reference/run/#ipc-settings---ipc",target:"_blank",rel:"noopener noreferrer"},R=s("li",null,[n("Seeing other weird errors when launching Chromium? Try running your container"),s("br"),n(" with "),s("code",null,"docker run --cap-add=SYS_ADMIN"),n(" when developing locally.")],-1),S=s("code",null,"--init",-1),A={href:"https://github.com/Yelp/dumb-init",target:"_blank",rel:"noopener noreferrer"},L=s("br",null,null,-1),N=s("h3",{id:"github-actions-via-containers",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#github-actions-via-containers","aria-hidden":"true"},"#"),n(" GitHub Actions (via containers)")],-1),O={href:"https://docs.github.com/en/actions/using-jobs/running-jobs-in-a-container",target:"_blank",rel:"noopener noreferrer"},H={href:"https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idcontainer",target:"_blank",rel:"noopener noreferrer"},B=s("code",null,"jobs.<job_id>.container",-1),q=t(`<div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">playwright</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;Playwright Tests&#39;</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">container</span><span class="token punctuation">:</span>
      <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/playwright<span class="token punctuation">:</span>v1.32.0<span class="token punctuation">-</span>focal
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">&#39;18&#39;</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies
        <span class="token key atrule">run</span><span class="token punctuation">:</span> npm ci
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run your tests
        <span class="token key atrule">run</span><span class="token punctuation">:</span> npx playwright test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">playwright</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;Playwright Tests&#39;</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">container</span><span class="token punctuation">:</span>
      <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/playwright<span class="token punctuation">:</span>v1.32.0<span class="token punctuation">-</span>focal
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Set up Python
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>python@v4
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">python-version</span><span class="token punctuation">:</span> <span class="token string">&#39;3.11&#39;</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          python -m pip install --upgrade pip
          pip install -r local-requirements.txt
          pip install -e .</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Ensure browsers are installed
        <span class="token key atrule">run</span><span class="token punctuation">:</span> python <span class="token punctuation">-</span>m playwright install <span class="token punctuation">-</span><span class="token punctuation">-</span>with<span class="token punctuation">-</span>deps
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run your tests
        <span class="token key atrule">run</span><span class="token punctuation">:</span> pytest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">playwright</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;Playwright Tests&#39;</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">container</span><span class="token punctuation">:</span>
      <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/playwright<span class="token punctuation">:</span>v1.32.0<span class="token punctuation">-</span>focal
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>java@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">distribution</span><span class="token punctuation">:</span> <span class="token string">&#39;temurin&#39;</span>
          <span class="token key atrule">java-version</span><span class="token punctuation">:</span> <span class="token string">&#39;17&#39;</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build &amp; Install
        <span class="token key atrule">run</span><span class="token punctuation">:</span> mvn <span class="token punctuation">-</span>B install <span class="token punctuation">-</span>D skipTests <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>transfer<span class="token punctuation">-</span>progress
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Playwright
        <span class="token key atrule">run</span><span class="token punctuation">:</span> mvn exec<span class="token punctuation">:</span>java <span class="token punctuation">-</span>e <span class="token punctuation">-</span>D exec.mainClass=com.microsoft.playwright.CLI <span class="token punctuation">-</span>D exec.args=&quot;install <span class="token punctuation">-</span><span class="token punctuation">-</span>with<span class="token punctuation">-</span>deps&quot;
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run tests
        <span class="token key atrule">run</span><span class="token punctuation">:</span> mvn test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">playwright</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;Playwright Tests&#39;</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">container</span><span class="token punctuation">:</span>
      <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/playwright<span class="token punctuation">:</span>v1.32.0<span class="token punctuation">-</span>focal
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Setup dotnet
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>dotnet@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">dotnet-version</span><span class="token punctuation">:</span> 6.0.x
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> dotnet build
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Ensure browsers are installed
        <span class="token key atrule">run</span><span class="token punctuation">:</span> pwsh bin\\Debug\\net6.0\\playwright.ps1 install <span class="token punctuation">-</span><span class="token punctuation">-</span>with<span class="token punctuation">-</span>deps
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run your tests
        <span class="token key atrule">run</span><span class="token punctuation">:</span> dotnet test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="sharding" tabindex="-1"><a class="header-anchor" href="#sharding" aria-hidden="true">#</a> Sharding</h4><ul><li>langs: js</li></ul>`,6),G={href:"https://docs.github.com/en/actions/using-jobs/using-a-matrix-for-your-jobs",target:"_blank",rel:"noopener noreferrer"},$={href:"https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstrategymatrix",target:"_blank",rel:"noopener noreferrer"},W=s("code",null,"jobs.<job_id>.strategy.matrix",-1),F=s("code",null,"matrix",-1),M=s("code",null,"project",-1),U=s("code",null,"shardIndex",-1),z=s("code",null,"shardTotal",-1),X=t(`<div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">playwright</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;Playwright Tests - \${{ matrix.project }} - Shard \${{ matrix.shardIndex }} of \${{ matrix.shardTotal }}&#39;</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">container</span><span class="token punctuation">:</span>
      <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/playwright<span class="token punctuation">:</span>v1.32.0<span class="token punctuation">-</span>focal
    <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
      <span class="token key atrule">fail-fast</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">matrix</span><span class="token punctuation">:</span>
        <span class="token key atrule">project</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>chromium<span class="token punctuation">,</span> webkit<span class="token punctuation">]</span>
        <span class="token key atrule">shardIndex</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>
        <span class="token key atrule">shardTotal</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">&#39;18&#39;</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies
        <span class="token key atrule">run</span><span class="token punctuation">:</span> npm ci
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run your tests
        <span class="token key atrule">run</span><span class="token punctuation">:</span> npx playwright test <span class="token punctuation">-</span><span class="token punctuation">-</span>project=$<span class="token punctuation">{</span><span class="token punctuation">{</span> matrix.project <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>shard=$<span class="token punctuation">{</span><span class="token punctuation">{</span> matrix.shardIndex <span class="token punctuation">}</span><span class="token punctuation">}</span>/$<span class="token punctuation">{</span><span class="token punctuation">{</span> matrix.shardTotal <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),J=s("code",null,"${{ <expression> }}",-1),V={href:"https://docs.github.com/en/actions/learn-github-actions/expressions",target:"_blank",rel:"noopener noreferrer"},Y={href:"https://docs.github.com/en/actions/learn-github-actions/contexts",target:"_blank",rel:"noopener noreferrer"},K={href:"https://docs.github.com/en/actions/learn-github-actions/contexts#matrix-context",target:"_blank",rel:"noopener noreferrer"},Q=s("code",null,"matrix",-1),Z=s("h3",{id:"azure-pipelines",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#azure-pipelines","aria-hidden":"true"},"#"),n(" Azure Pipelines")],-1),nn=s("p",null,"For Windows or macOS agents, no additional configuration required, just install Playwright and run your tests.",-1),sn=s("br",null,null,-1),an={href:"https://docs.microsoft.com/en-us/azure/devops/pipelines/process/container-phases?view=azure-devops",target:"_blank",rel:"noopener noreferrer"},en=s("br",null,null,-1),tn=s("br",null,null,-1),ln=t(`<p>For running the Playwright tests use this pipeline task:</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">deployment</span><span class="token punctuation">:</span> Run_E2E_Tests
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token key atrule">vmImage</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span><span class="token number">20.04</span>
      <span class="token key atrule">container</span><span class="token punctuation">:</span> mcr.microsoft.com/playwright<span class="token punctuation">:</span>v1.32.0<span class="token punctuation">-</span>focal
      <span class="token key atrule">environment</span><span class="token punctuation">:</span> testing
      <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">runOnce</span><span class="token punctuation">:</span>
          <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
            <span class="token key atrule">steps</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">checkout</span><span class="token punctuation">:</span> self
            <span class="token punctuation">-</span> <span class="token key atrule">task</span><span class="token punctuation">:</span> Bash@3
              <span class="token key atrule">displayName</span><span class="token punctuation">:</span> <span class="token string">&#39;Run Playwright tests&#39;</span>
              <span class="token key atrule">inputs</span><span class="token punctuation">:</span>
                <span class="token key atrule">workingDirectory</span><span class="token punctuation">:</span> <span class="token string">&#39;my-e2e-tests&#39;</span>
                <span class="token key atrule">targetType</span><span class="token punctuation">:</span> <span class="token string">&#39;inline&#39;</span>
                <span class="token key atrule">failOnStderr</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">env</span><span class="token punctuation">:</span>
                  <span class="token key atrule">CI</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">script</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
                  npm ci
                  npx playwright test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This will make the pipeline run fail if any of the playwright tests fails.<br> If you also want to integrate the test results with Azure DevOps, use the task <code>PublishTestResults</code> task like so:</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">deployment</span><span class="token punctuation">:</span> Run_E2E_Tests
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token key atrule">vmImage</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span><span class="token number">20.04</span>
      <span class="token key atrule">container</span><span class="token punctuation">:</span> mcr.microsoft.com/playwright<span class="token punctuation">:</span>v1.32.0<span class="token punctuation">-</span>focal
      <span class="token key atrule">environment</span><span class="token punctuation">:</span> testing
      <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">runOnce</span><span class="token punctuation">:</span>
          <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
            <span class="token key atrule">steps</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">checkout</span><span class="token punctuation">:</span> self
            <span class="token punctuation">-</span> <span class="token key atrule">task</span><span class="token punctuation">:</span> Bash@3
              <span class="token key atrule">displayName</span><span class="token punctuation">:</span> <span class="token string">&#39;Run Playwright tests&#39;</span>
              <span class="token key atrule">inputs</span><span class="token punctuation">:</span>
                <span class="token key atrule">workingDirectory</span><span class="token punctuation">:</span> <span class="token string">&#39;my-e2e-tests&#39;</span>
                <span class="token key atrule">targetType</span><span class="token punctuation">:</span> <span class="token string">&#39;inline&#39;</span>
                <span class="token key atrule">failOnStderr</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">env</span><span class="token punctuation">:</span>
                  <span class="token key atrule">CI</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">script</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
                  npm ci
                  npx playwright test</span>
            <span class="token punctuation">-</span> <span class="token key atrule">task</span><span class="token punctuation">:</span> PublishTestResults@2
              <span class="token key atrule">displayName</span><span class="token punctuation">:</span> <span class="token string">&#39;Publish test results&#39;</span>
              <span class="token key atrule">inputs</span><span class="token punctuation">:</span>
                <span class="token key atrule">searchFolder</span><span class="token punctuation">:</span> <span class="token string">&#39;my-e2e-tests/test-results&#39;</span>
                <span class="token key atrule">testResultsFormat</span><span class="token punctuation">:</span> <span class="token string">&#39;JUnit&#39;</span>
                <span class="token key atrule">testResultsFiles</span><span class="token punctuation">:</span> <span class="token string">&#39;e2e-junit-results.xml&#39;</span> 
                <span class="token key atrule">mergeTestResults</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">failTaskOnFailedTests</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">testRunTitle</span><span class="token punctuation">:</span> <span class="token string">&#39;My End-To-End Tests&#39;</span>
              <span class="token key atrule">condition</span><span class="token punctuation">:</span> succeededOrFailed()

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Note: The JUnit reporter needs to be configured accordingly via</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token punctuation">[</span><span class="token string">&quot;junit&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> outputFile<span class="token operator">:</span> <span class="token string">&quot;test-results/e2e-junit-results.xml&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>in <code>playwright.config.ts</code>.</p><h3 id="circleci" tabindex="-1"><a class="header-anchor" href="#circleci" aria-hidden="true">#</a> CircleCI</h3>`,8),pn=s("code",null,"docker:",-1),on=t(`<div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">executors</span><span class="token punctuation">:</span>
   <span class="token key atrule">pw-focal-development</span><span class="token punctuation">:</span>
     <span class="token key atrule">docker</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/playwright<span class="token punctuation">:</span>v1.32.0<span class="token punctuation">-</span>focal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),cn={href:"https://circleci.com/docs/configuration-reference?#docker-execution-environment",target:"_blank",rel:"noopener noreferrer"},un=t(`<p>Similarly, If youre using Playwright through Jest, then you may encounter an error spawning child processes:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[00:00.0]  jest args: --e2e --spec --max-workers=36
Error: spawn ENOMEM
   at ChildProcess.spawn (internal/child_process.js:394:11)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This is likely caused by Jest autodetecting the number of processes on the entire machine (<code>36</code>) rather than the number allowed to your container (<code>2</code>). To fix this, set <code>jest --maxWorkers=2</code> in your test command.</p><h4 id="sharding-in-circleci" tabindex="-1"><a class="header-anchor" href="#sharding-in-circleci" aria-hidden="true">#</a> Sharding in CircleCI</h4><p>Sharding in CircleCI is indexed with 0 which means that you will need to override the default parallelism ENV VARS. The following example demonstrates how to run Playwright with a CircleCI Parallelism of 4 by adding 1 to the <code>CIRCLE_NODE_INDEX</code> to pass into the <code>--shard</code> cli arg.</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code>  <span class="token key atrule">playwright-job-name</span><span class="token punctuation">:</span>
    <span class="token key atrule">executor</span><span class="token punctuation">:</span> pw<span class="token punctuation">-</span>focal<span class="token punctuation">-</span>development
    <span class="token key atrule">parallelism</span><span class="token punctuation">:</span> <span class="token number">4</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> SHARD=&quot;$(($<span class="token punctuation">{</span>CIRCLE_NODE_INDEX<span class="token punctuation">}</span>+1))&quot;; npx playwright test <span class="token punctuation">-</span><span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>shard=$<span class="token punctuation">{</span>SHARD<span class="token punctuation">}</span>/$<span class="token punctuation">{</span>CIRCLE_NODE_TOTAL<span class="token punctuation">}</span>      
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="jenkins" tabindex="-1"><a class="header-anchor" href="#jenkins" aria-hidden="true">#</a> Jenkins</h3>`,7),rn=s("br",null,null,-1),dn=t(`<div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code>pipeline <span class="token punctuation">{</span>
   agent <span class="token punctuation">{</span> docker <span class="token punctuation">{</span> image <span class="token string">&#39;mcr.microsoft.com/playwright:v1.32.0-focal&#39;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
   stages <span class="token punctuation">{</span>
      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">&#39;e2e-tests&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         steps <span class="token punctuation">{</span>
            <span class="token comment">// Depends on your language / test framework</span>
            sh <span class="token string">&#39;npm install&#39;</span>
            sh <span class="token string">&#39;npx playwright test&#39;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="bitbucket-pipelines" tabindex="-1"><a class="header-anchor" href="#bitbucket-pipelines" aria-hidden="true">#</a> Bitbucket Pipelines</h3>`,2),kn={href:"https://confluence.atlassian.com/bitbucket/use-docker-images-as-build-environments-792298897.html",target:"_blank",rel:"noopener noreferrer"},vn=t(`<div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/playwright<span class="token punctuation">:</span>v1.32.0<span class="token punctuation">-</span>focal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="gitlab-ci" tabindex="-1"><a class="header-anchor" href="#gitlab-ci" aria-hidden="true">#</a> GitLab CI</h3>`,2),mn=t(`<div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">stages</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> test

<span class="token key atrule">tests</span><span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
  <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/playwright<span class="token punctuation">:</span>v1.32.0<span class="token punctuation">-</span>focal
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
  <span class="token punctuation">...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="sharding-1" tabindex="-1"><a class="header-anchor" href="#sharding-1" aria-hidden="true">#</a> Sharding</h4><ul><li>langs: js</li></ul>`,3),hn={href:"https://docs.gitlab.com/ee/ci/jobs/job_control.html#parallelize-large-jobs",target:"_blank",rel:"noopener noreferrer"},bn={href:"https://docs.gitlab.com/ee/ci/yaml/index.html#parallel",target:"_blank",rel:"noopener noreferrer"},yn=s("code",null,"job_name 1/N",-1),gn=s("code",null,"job_name N/N",-1),wn=t(`<div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">stages</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> test

<span class="token key atrule">tests</span><span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
  <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/playwright<span class="token punctuation">:</span>v1.32.0<span class="token punctuation">-</span>focal
  <span class="token key atrule">parallel</span><span class="token punctuation">:</span> <span class="token number">7</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> npm ci
    <span class="token punctuation">-</span> npx playwright test <span class="token punctuation">-</span><span class="token punctuation">-</span>shard=$CI_NODE_INDEX/$CI_NODE_TOTAL
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),_n={href:"https://docs.gitlab.com/ee/ci/yaml/index.html#parallelmatrix",target:"_blank",rel:"noopener noreferrer"},fn=s("code",null,"PROJECT",-1),xn=s("code",null,"SHARD_INDEX",-1),jn=s("code",null,"SHARD_TOTAL",-1),Tn=t(`<div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">stages</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> test

<span class="token key atrule">tests</span><span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
  <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/playwright<span class="token punctuation">:</span>v1.32.0<span class="token punctuation">-</span>focal
  <span class="token key atrule">parallel</span><span class="token punctuation">:</span>
    <span class="token key atrule">matrix</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">PROJECT</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#39;chromium&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;webkit&#39;</span><span class="token punctuation">]</span>
        <span class="token key atrule">SHARD_INDEX</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>
        <span class="token key atrule">SHARD_TOTAL</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> npm ci
    <span class="token punctuation">-</span> npx playwright test <span class="token punctuation">-</span><span class="token punctuation">-</span>project=$PROJECT <span class="token punctuation">-</span><span class="token punctuation">-</span>shard=$SHARD_INDEX/$SHARD_TOTAL
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="caching-browsers" tabindex="-1"><a class="header-anchor" href="#caching-browsers" aria-hidden="true">#</a> Caching browsers</h2>`,2),In=s("br",null,null,-1),Cn=s("code",null,"postinstall",-1),Pn=s("br",null,null,-1),Dn=s("p",null,[n("Caching browsers on CI is "),s("strong",null,"strictly optional"),n(": The "),s("code",null,"postinstall"),n(" hooks should"),s("br"),n(" execute and download the browser binaries on every run.")],-1),En=s("h4",{id:"exception-node-modules-are-cached-node-specific",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#exception-node-modules-are-cached-node-specific","aria-hidden":"true"},"#"),n(" Exception: "),s("code",null,"node_modules"),n(" are cached (Node-specific)")],-1),Rn={href:"https://docs.npmjs.com/cli-commands/cache.html",target:"_blank",rel:"noopener noreferrer"},Sn=s("br",null,null,-1),An=s("code",null,"$HOME/.npm",-1),Ln=s("code",null,"node_modules",-1),Nn=s("br",null,null,-1),On=s("code",null,"npm install",-1),Hn=s("code",null,"npm ci",-1),Bn=s("br",null,null,-1),qn=s("strong",null,"will not work",-1),Gn=s("code",null,"npm install",-1),$n=s("br",null,null,-1),Wn=s("code",null,"postinstall",-1),Fn=s("blockquote",null,[s("p",null,[n("Travis CI automatically caches "),s("code",null,"node_modules"),n(" if your repo does not have a"),s("br"),s("code",null,"package-lock.json"),n(" file.")])],-1),Mn=s("p",null,"This behavior can be fixed with one of the following approaches:",-1),Un=s("li",null,[n("Move to caching "),s("code",null,"$HOME/.npm"),n(" or the npm-cache directory. (This is the default"),s("br"),n(" behavior in most CI providers.)")],-1),zn=s("code",null,"PLAYWRIGHT_BROWSERS_PATH=0",-1),Xn=s("br",null,null,-1),Jn=s("code",null,"npm install",-1),Vn=s("code",null,"node_modules",-1),Yn=s("br",null,null,-1),Kn=s("code",null,"npm ci",-1),Qn=s("code",null,"npm install",-1),Zn=s("br",null,null,-1),ns=s("code",null,"node_modules",-1),ss={href:"https://docs.npmjs.com/cli/ci.html",target:"_blank",rel:"noopener noreferrer"},as=s("li",null,"Cache the browser binaries, with the steps below.",-1),es=t(`<h4 id="directories-to-cache" tabindex="-1"><a class="header-anchor" href="#directories-to-cache" aria-hidden="true">#</a> Directories to cache</h4><p>With the default behavior, Playwright downloads the browser binaries in the following<br> directories:</p><ul><li><code>%USERPROFILE%\\AppData\\Local\\ms-playwright</code> on Windows</li><li><code>~/Library/Caches/ms-playwright</code> on MacOS</li><li><code>~/.cache/ms-playwright</code> on Linux</li></ul><p>To cache the browser downloads between CI runs, cache this location in your CI<br> configuration, against a hash of the Playwright version.</p><h2 id="debugging-browser-launches" tabindex="-1"><a class="header-anchor" href="#debugging-browser-launches" aria-hidden="true">#</a> Debugging browser launches</h2><p>Playwright supports the <code>DEBUG</code> environment variable to output debug logs during execution. Setting it to <code>pw:browser*</code> is helpful while debugging <code>Error: Failed to launch browser</code> errors.</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">DEBUG</span><span class="token operator">=</span>pw:browser* npx playwright <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">DEBUG</span><span class="token operator">=</span>pw:browser* pytest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="running-headed" tabindex="-1"><a class="header-anchor" href="#running-headed" aria-hidden="true">#</a> Running headed</h2><p>By default, Playwright launches browsers in headless mode. This can be changed by passing a flag when the browser is launched.</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// Works across chromium, firefox and webkit</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> chromium <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;playwright&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> chromium<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Works across chromium, firefox and webkit</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>microsoft<span class="token punctuation">.</span>playwright<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Playwright</span> playwright <span class="token operator">=</span> <span class="token class-name">Playwright</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">BrowserType</span> chromium <span class="token operator">=</span> playwright<span class="token punctuation">.</span><span class="token function">chromium</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Browser</span> browser <span class="token operator">=</span> chromium<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BrowserType<span class="token punctuation">.</span>LaunchOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setHeadless</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> asyncio
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>async_api <span class="token keyword">import</span> async_playwright

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> async_playwright<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> p<span class="token punctuation">:</span>
         <span class="token comment"># Works across chromium, firefox and webkit</span>
         browser <span class="token operator">=</span> <span class="token keyword">await</span> p<span class="token punctuation">.</span>chromium<span class="token punctuation">.</span>launch<span class="token punctuation">(</span>headless<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> sync_playwright

<span class="token keyword">with</span> sync_playwright<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> p<span class="token punctuation">:</span>
   <span class="token comment"># Works across chromium, firefox and webkit</span>
   browser <span class="token operator">=</span> p<span class="token punctuation">.</span>chromium<span class="token punctuation">.</span>launch<span class="token punctuation">(</span>headless<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Playwright</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> playwright <span class="token operator">=</span> <span class="token keyword">await</span> Playwright<span class="token punctuation">.</span><span class="token function">CreateAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> playwright<span class="token punctuation">.</span>Chromium<span class="token punctuation">.</span><span class="token function">LaunchAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Headless <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,15),ts={href:"https://en.wikipedia.org/wiki/Xvfb",target:"_blank",rel:"noopener noreferrer"},ls=s("code",null,"xvfb-run",-1),ps=t(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>xvfb-run <span class="token function">node</span> index.js
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>xvfb-run python test.py
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,2);function is(os,cs){const l=i("RouterLink"),e=i("ExternalLinkIcon");return c(),u("div",null,[k,r(" TOC "),v,m,s("ol",null,[s("li",null,[s("p",null,[h,n(": Use "),a(l,{to:"/book/playwright/docker.html"},{default:p(()=>[n("our Docker image")]),_:1}),b,n(" in Linux agents or install your dependencies using the "),a(l,{to:"/book/playwright/cli.html#install-system-dependencies"},{default:p(()=>[n("CLI")]),_:1}),n(".")])]),y]),g,s("p",null,[n("The "),a(l,{to:"/book/playwright/cli.html#install-system-dependencies"},{default:p(()=>[n("Command line tools")]),_:1}),n(" can be used to install all operating system dependencies on GitHub Actions.")]),w,s("p",null,[n("We run "),s("a",_,[n("our tests"),a(e)]),n(" on GitHub Actions, across a matrix of 3 platforms (Windows, Linux, macOS) and 3 browsers (Chromium, Firefox, WebKit).")]),f,s("p",null,[n("This will start the tests after a "),s("a",x,[n("GitHub Deployment"),a(e)]),n(" went into the "),j,n(" state."),T,n(" Services like Vercel use this pattern so you can run your end-to-end tests on their deployed environment.")]),I,s("p",null,[n("We have a "),a(l,{to:"/book/playwright/docker.html"},{default:p(()=>[n("pre-built Docker image")]),_:1}),n(" which can either be used directly, or as a reference to update your existing Docker definitions.")]),C,s("ol",null,[s("li",null,[n("Using "),P,n(" is also recommended when using Chromiumwithout it Chromium can run out of memory"),D,n(" and crash. Learn more about this option in "),s("a",E,[n("Docker docs"),a(e)]),n(".")]),R,s("li",null,[n("Using "),S,n(" Docker flag or "),s("a",A,[n("dumb-init"),a(e)]),n(" is recommended to avoid special"),L,n(" treatment for processes with PID=1. This is a common reason for zombie processes.")])]),N,s("p",null,[n("GitHub Actions support "),s("a",O,[n("running jobs in a container"),a(e)]),n(" by using the "),s("a",H,[B,a(e)]),n(" option.")]),q,s("p",null,[n("GitHub Actions supports "),s("a",G,[n("sharding tests between multiple jobs"),a(e)]),n(" using the "),s("a",$,[W,a(e)]),n(" option. The "),F,n(" option will run a separate job for every possible combination of the provided options. In the example below, we have 2 "),M,n(" values, 10 "),U,n(" values and 1 "),z,n(" value, resulting in a total of 20 jobs to be run.")]),X,s("blockquote",null,[s("p",null,[n("Note: The "),J,n(" is the "),s("a",V,[n("expression"),a(e)]),n(" syntax that allows accessing the current "),s("a",Y,[n("context"),a(e)]),n(". In this example, we are using the "),s("a",K,[Q,a(e)]),n(" context to set the job variants.")])]),Z,nn,s("p",null,[n("For Linux agents, you can use "),a(l,{to:"/book/playwright/docker.html"},{default:p(()=>[n("our Docker container")]),_:1}),n(" with Azure"),sn,n(" Pipelines support "),s("a",an,[n("running containerized"),en,n(" jobs"),a(e)]),n("."),tn,n(" Alternatively, you can use "),a(l,{to:"/book/playwright/cli.html#install-system-dependencies"},{default:p(()=>[n("Command line tools")]),_:1}),n(" to install all necessary dependencies.")]),ln,s("p",null,[n("Running Playwright on CircleCI is very similar to running on GitHub Actions. In order to specify the pre-built Playwright "),a(l,{to:"/book/playwright/docker.html"},{default:p(()=>[n("Docker image")]),_:1}),n(" , simply modify the agent definition with "),pn,n(" in your config like so:")]),on,s("p",null,[n("Note: When using the docker agent definition, you are specifying the resource class of where playwright runs to the 'medium' tier "),s("a",cn,[n("here"),a(e)]),n(". The default behavior of Playwright is to set the number of workers to the detected core count (2 in the case of the medium tier). Overriding the number of workers to greater than this number will cause unnecessary timeouts and failures.")]),un,s("p",null,[n("Jenkins supports Docker agents for pipelines. Use the "),a(l,{to:"/book/playwright/docker.html"},{default:p(()=>[n("Playwright Docker image")]),_:1}),rn,n(" to run tests on Jenkins.")]),dn,s("p",null,[n("Bitbucket Pipelines can use public "),s("a",kn,[n("Docker images as build environments"),a(e)]),n(". To run Playwright tests on Bitbucket, use our public Docker image ("),a(l,{to:"/book/playwright/docker.html"},{default:p(()=>[n("see Dockerfile")]),_:1}),n(").")]),vn,s("p",null,[n("To run Playwright tests on GitLab, use our public Docker image ("),a(l,{to:"/book/playwright/docker.html"},{default:p(()=>[n("see Dockerfile")]),_:1}),n(").")]),mn,s("p",null,[n("GitLab CI supports "),s("a",hn,[n("sharding tests between multiple jobs"),a(e)]),n(" using the "),s("a",bn,[n("parallel"),a(e)]),n(" keyword. The test job will be split into multiple smaller jobs that run in parallel. Parallel jobs are named sequentially from "),yn,n(" to "),gn,n(".")]),wn,s("p",null,[n("GitLab CI also supports sharding tests between multiple jobs using the "),s("a",_n,[n("parallel:matrix"),a(e)]),n(" option. The test job will run multiple times in parallel in a single pipeline, but with different variable values for each instance of the job. In the example below, we have 2 "),fn,n(" values, 10 "),xn,n(" values and 1 "),jn,n(" value, resulting in a total of 20 jobs to be run.")]),Tn,s("p",null,[n("By default, Playwright downloads browser binaries when the Playwright NPM package"),In,n(" is installed. The NPM packages have a "),Cn,n(" hook that downloads the browser"),Pn,n(" binaries. This behavior can be "),a(l,{to:"/book/playwright/browsers.html#managing-browser-binaries"},{default:p(()=>[n("customized with environment variables")]),_:1}),n(".")]),Dn,En,s("p",null,[n("Most CI providers cache the "),s("a",Rn,[n("npm-cache"),a(e)]),Sn,n(" directory (located at "),An,n("). If your CI pipelines caches the "),Ln,Nn,n(" directory and you run "),On,n(" (instead of "),Hn,n("), the default configuration"),Bn,qn,n(". This is because the "),Gn,n(" step will find the Playwright NPM"),$n,n(" package on disk and not execute the "),Wn,n(" step.")]),Fn,Mn,s("ol",null,[Un,s("li",null,[n("Set "),zn,n(" as the environment variable before running"),Xn,Jn,n(". This will download the browser binaries in the "),Vn,Yn,n(" directory and cache them with the package code. See "),a(l,{to:"/book/playwright/browsers.html#managing-browser-binaries"},{default:p(()=>[n("managing browser binaries")]),_:1}),n(".")]),s("li",null,[n("Use "),Kn,n(" (instead of "),Qn,n(") which forces a clean install: by"),Zn,n(" removing the existing "),ns,n(" directory. See "),s("a",ss,[n("npm docs"),a(e)]),n(".")]),as]),es,s("p",null,[n("On Linux agents, headed execution requires "),s("a",ts,[n("Xvfb"),a(e)]),n(" to be installed. Our "),a(l,{to:"/book/playwright/docker.html"},{default:p(()=>[n("Docker image")]),_:1}),n(" and GitHub Action have Xvfb pre-installed. To run browsers in headed mode with Xvfb, add "),ls,n(" before the Node.js command.")]),ps])}const ds=o(d,[["render",is],["__file","ci.html.vue"]]);export{ds as default};
