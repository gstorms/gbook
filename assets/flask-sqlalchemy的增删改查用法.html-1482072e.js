import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{r as t,o as p,c as o,a as n,b as s,d as c,f as l}from"./app-207e7d61.js";const i={},r=n("h1",{id:"flask-sqlalchemy的增删改查用法",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#flask-sqlalchemy的增删改查用法","aria-hidden":"true"},"#"),s(" flask-sqlalchemy的增删改查用法")],-1),u=n("h1",{id:"查询-插入-删除",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#查询-插入-删除","aria-hidden":"true"},"#"),s(" 查询，插入，删除")],-1),d={href:"http://flask-sqlalchemy.pocoo.org/2.3/models/#models",target:"_blank",rel:"noopener noreferrer"},k=n("code",null,"model",-1),m=n("br",null,null,-1),g=l(`<h2 id="插入数据" tabindex="-1"><a class="header-anchor" href="#插入数据" aria-hidden="true">#</a> 插入数据</h2><p>插入数据到数据库中有3个步骤：</p><ol><li>创建<code>Python</code>对象</li><li>把它加入到<code>session</code>中</li><li>提交（<code>commit</code>）<code>session</code></li></ol><p><code>session</code>不是<code>Flask session</code>，而是 <code>Flask-SQLAlchemy</code>的<code>session</code>。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> yourapp <span class="token keyword">import</span> User
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> me <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token string">&#39;admin&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;admin@example.com&#39;</span><span class="token punctuation">)</span> <span class="token comment">#步骤1</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>me<span class="token punctuation">)</span> <span class="token comment">#步骤2</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit <span class="token comment">#步骤3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>数据已经添加到数据库了，可以查看：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> me<span class="token punctuation">.</span><span class="token builtin">id</span>
<span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="删除" tabindex="-1"><a class="header-anchor" href="#删除" aria-hidden="true">#</a> 删除</h2><p>删除和插入类似，只要把<code>add()</code>替换为<code>delete()</code>就行了</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>me<span class="token punctuation">)</span> <span class="token comment">#步骤2</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit <span class="token comment">#步骤3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="查询" tabindex="-1"><a class="header-anchor" href="#查询" aria-hidden="true">#</a> 查询</h2><p>使用query进行查询，如果要筛选使用filter关键字，选取结果的第一条用first关键字，选取全部结果用all关键字，如果用主键查询，直接用get。<br> 数据：</p><table><thead><tr><th>id</th><th>username</th><th>email</th></tr></thead><tbody><tr><td>1</td><td>admin</td><td><a href="mailto:admin@example.com">admin@example.com</a></td></tr><tr><td>2</td><td>peter</td><td><a href="mailto:peter@example.org">peter@example.org</a></td></tr><tr><td>3</td><td>guest</td><td><a href="mailto:guest@example.com">guest@example.com</a></td></tr></tbody></table><p>通过username查询：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> peter <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">&#39;peter&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> peter<span class="token punctuation">.</span><span class="token builtin">id</span>
<span class="token number">2</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> peter<span class="token punctuation">.</span>email
peter@example<span class="token punctuation">.</span>org
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用不在表中的username查询：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> missing <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">&#39;missing&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> missing <span class="token keyword">is</span> <span class="token boolean">None</span>
<span class="token boolean">True</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过更复杂的表达式获取多个用户：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>User<span class="token punctuation">.</span>email<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">&#39;@example.com&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>User <span class="token string">u&#39;admin&#39;</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>User <span class="token string">u&#39;guest&#39;</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>通过某个字段排序：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>User<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>User <span class="token string">u&#39;admin&#39;</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>User <span class="token string">u&#39;guest&#39;</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>User <span class="token string">u&#39;peter&#39;</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>限制查询结果：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>limit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>User <span class="token string">u&#39;admin&#39;</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>通过主键获取数据：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>User <span class="token string">u&#39;admin&#39;</span><span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="在flask-views中查询用法" tabindex="-1"><a class="header-anchor" href="#在flask-views中查询用法" aria-hidden="true">#</a> 在flask views中查询用法</h2><p>因为有时候会获取不到数据，一般用get_or_404()替换get(),first_or_404()替换first()。此时会抛出404错误，而不是返回None。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">&#39;/user/&lt;username&gt;&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">show_user</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span>first_or_404<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">&#39;show_user.html&#39;</span><span class="token punctuation">,</span> user<span class="token operator">=</span>user<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,28);function v(h,b){const a=t("ExternalLinkIcon");return p(),o("div",null,[r,u,n("p",null,[s("已经创建过数据库"),n("a",d,[k,c(a)]),s("了，可以直接从数据库中查询数据了。"),m,s(" 前提：在model中定义数据模型。")]),g])}const f=e(i,[["render",v],["__file","flask-sqlalchemy的增删改查用法.html.vue"]]);export{f as default};
